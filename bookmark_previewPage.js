(function(){var saveAsScript=document.createElement("script");saveAsScript.src="https://rawgit.com/stephaneAG/123DCircuitsDL/master/FileSaver.js",document.body.appendChild(saveAsScript);var saveZipScript=document.createElement("script");saveZipScript.src="https://rawgit.com/stephaneAG/123DCircuitsDL/master/jsZip.js",document.body.appendChild(saveZipScript);var circuitTitle=document.querySelector(".vertical-spacing--title").textContent.substr(0,document.querySelector(".vertical-spacing--title").textContent.indexOf("|")-3).trimStart(),menus=document.querySelectorAll("div.sitemenu__right__item--editor"),links=menus[0].querySelectorAll("a"),viewsLinks=[];[].forEach.call(links,function(e){"bom"!==e.href.substr(e.href.indexOf("#")+1)&&viewsLinks.push([e.href.substr(e.href.indexOf("#")+1),e.querySelector("svg"),document.querySelector(e.href.substr(e.href.indexOf("#"))+"Tab").querySelector("svg"),"svg"])});var bomLink=document.querySelector('a[href="#bom"]');bomLink.click();var htmlTable=document.querySelector("table.bom__table"),csvContent=htmlTable.innerText.replace(/\s{8}/g,"\t").replace(/\s{3,}/g,"\n").replace(/\t{1,}/g,",");csvContent.replace(/,\n/g,',""\n'),csvContent.endsWith(",")&&(csvContent+='""\n'),viewsLinks.push([bomLink.href.substr(bomLink.href.indexOf("#")+1),bomLink.querySelector("svg"),(new XMLSerializer).serializeToString(htmlTable),"html"],[bomLink.href.substr(bomLink.href.indexOf("#")+1),bomLink.querySelector("svg"),circuitTitle+" - Bill Of Materials\n"+csvContent,"csv"]);var popupUl=document.createElement("ul");popupUl.style.paddingLeft="0px",viewsLinks.forEach(function(e){var t=document.createElement("li");t.className="circuit-view",t.setAttribute("data-viewType",e[0]),t.setAttribute("data-viewExt",e[3]),t.style.display="block",t.style.height="50px";var i=document.createElement("input");i.type="checkbox",i.id=e[0],i.style.float="left",i.style.marginTop="2.5px",i.style.marginRight="10px",i.style.width=i.style.height="50px",i.style.marginTop="0px",i.style.opacity="0",i.style.cursor="pointer",i.onchange=function(){console.log("CHECKBOX CHANGE HAPPENED !"),this.checked?(checkToZip(this.parentElement.getAttribute("data-viewType")+"_"+this.parentElement.getAttribute("data-viewExt")),this.nextSibling.innerHTML="&#10003;",this.nextSibling.style.color="#0696D7",this.nextSibling.nextSibling.style.color="#0696D7"):(uncheckToZip(this.parentElement.getAttribute("data-viewType")+"_"+this.parentElement.getAttribute("data-viewExt")),this.nextSibling.innerHTML="&#9675;",this.nextSibling.style.color="#C5CFD9",this.nextSibling.nextSibling.style.color="#C5CFD9")};var n=document.createElement("div");n.style.pointerEvents="none",n.className="sitemenu__view_switch sitemenu__svg_block_btn",n.style.float="left",n.style.marginLeft="-62px",n.innerHTML="&#9675;",n.style.color="rgb(197, 207, 217);",n.style.fontSize="30px",n.style.textAlign="center",n.style.lineHeight="50px",n.onmouseenter=function(){this.setAttribute("data-glyph",this.innerHTML),this.innerHTML="&#10003;",console.log("iconDiv mouse enter happened !")},n.onmouseleave=function(){this.innerHTML=this.getAttribute("data-glyph"),console.log("iconDiv mouse leave happened !")};var o=document.createElement("a");o.textContent=e[0],"bom"===e[0]?o.textContent=e[0]+" (."+e[3]+")":o.textContent=e[0],o.style.display="block",o.style.lineHeight="50px",o.style.fontSize="20px",o.onclick=function(){console.log(this.parentElement.getAttribute("data-viewType")+" to be savedAs !"),saveViewAs(this.parentElement.getAttribute("data-viewType")+"_"+this.parentElement.getAttribute("data-viewExt"))},o.onmouseover=function(){this.setAttribute("data-color",this.style.color),this.style.color="#0696D7",console.log("dlLink mouse over happened !")},o.onmouseout=function(){this.style.color=this.getAttribute("data-color"),console.log("dlLink mouse out happened !")},t.appendChild(i),t.appendChild(n),t.appendChild(o),popupUl.appendChild(t)});var popupTitle=document.createElement("h4");popupTitle.textContent="Export options",popupTitle.style.fontFamily='"Roboto",sans-serif',popupTitle.style.fontWeight="500",popupTitle.style.paddingTop="18px",popupTitle.style.textAlign="center";var dlZipLink=document.createElement("a");dlZipLink.textContent=circuitTitle.replace(/ /g,"_")+".zip",dlZipLink.style.textOverflow="ellipsis";var hint=document.createElement("p");hint.innerHTML="click to download,<br> tick to add to .zip",hint.style.textAlign="center",hint.style.fontSize="15px";var popupDiv=document.createElement("div");function checkToZip(e){window.toZip.push(e),console.log("viewTypes to be zipped: "+window.toZip)}function uncheckToZip(e){for(var t=0;t<window.toZip.length;t++)if(window.toZip[t]===e){window.toZip.splice(t,1);break}console.log("viewTypes to be zipped: "+window.toZip)}function getViewFromType(e){for(var t=0;t<viewsLinks.length;t++)if(viewsLinks[t][0]+"_"+viewsLinks[t][3]===e)return viewsLinks[t]}function saveViewAs(e){var t=getViewFromType(e);if("csv"===t[3]){var i=new Blob([t[2]],{type:"text/plain;charset=utf-8"});saveAs(i,t[0]+"."+t[3])}else if("html"===t[3]){i=new Blob([t[2]],{type:"text/html;charset=utf-8"});saveAs(i,t[0]+"."+t[3])}else if("svg"===t[3]){var n=(new XMLSerializer).serializeToString(t[2]);i=new Blob(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+n],{type:"image/svg+xml;charset=utf-8"});saveAs(i,t[0]+"."+t[3])}}function setDlConfig(){document.querySelector("#dlPopup").querySelectorAll('input[type="checkbox"]').forEach(function(e){e.click()}),console.log("showiiing-yum ( not chewing gum ! )")}function showDlPopup(e){setDlConfig(),popupDiv.style.right="0px"}function hideDlPopup(){popupDiv.style.right="-200px"}popupDiv.id="dlPopup",popupDiv.appendChild(popupTitle),popupDiv.appendChild(hint),popupDiv.appendChild(popupUl),popupDiv.appendChild(dlZipLink),popupDiv.style.zIndex=1e3,popupDiv.style.position="absolute",popupDiv.style.backgroundColor="white",popupDiv.style.right="0px",popupDiv.style.top="48px",popupDiv.style.borderTop="1px solid #C5CFD9",popupDiv.style.width="192px",popupDiv.style.paddingTop="5.5px",popupDiv.style.paddingLeft="5.5px",popupDiv.style.paddingBottom="5.5px",popupDiv.style.textOverflow="ellipsis",popupDiv.style.overflowX="hidden",popupDiv.style.right="-200px",popupDiv.style.webkitTransition="right 500ms ease-out",document.body.appendChild(popupDiv),window.toZip=[],dlZipLink.onclick=function(){console.log("get the items names from toZip array & zim 'em all ! ");for(var e=new JSZip,t=0;t<window.toZip.length;t++){var i=getViewFromType(window.toZip[t]);if("csv"===i[3])e.file(i[0]+"."+i[3],i[2]+"\n");else if("html"===i[3])e.file(i[0]+"."+i[3],i[2]);else if("svg"===i[3]){var n=(new XMLSerializer).serializeToString(i[2]);e.file(i[0]+"."+i[3],'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+n)}}var o=e.generate({type:"blob"});saveAs(o,circuitTitle.replace(/ /g,"_")+".zip")},setTimeout(function(){showDlPopup()},500);})();
